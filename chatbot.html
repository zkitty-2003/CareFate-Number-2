<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareFate - Chat Assistant</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css?v=3">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <style>
        /* Chat Specific Styles */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 80%;
            padding: 0.8rem 1.2rem;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        .message.user {
            align-self: flex-end;
            background: var(--primary-color);
            color: var(--bg-color);
            /* Contrast text */
            border-bottom-right-radius: 4px;
        }

        /* Theme Adjustments for User Bubble */
        body.theme-youth .message.user {
            background: #f472b6;
            color: white;
        }

        body.theme-working .message.user {
            background: #3b82f6;
            color: white;
        }

        body.theme-elder .message.user {
            background: black;
            color: white;
            border: 1px solid white;
        }

        .message.bot {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.15);
            color: var(--text-color);
            border-bottom-left-radius: 4px;
            border: 1px solid var(--card-border);
        }

        .chat-input-area {
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            display: flex;
            gap: 0.8rem;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 0.8rem 1.2rem;
            border-radius: 25px;
            border: 1px solid var(--card-border);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            outline: none;
            font-family: inherit;
        }

        .chat-input:focus {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--text-muted);
        }

        .send-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            background: var(--primary-color);
            color: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        body.theme-youth .send-btn {
            background: #f472b6;
            color: white;
        }

        body.theme-working .send-btn {
            background: #3b82f6;
            color: white;
        }

        body.theme-elder .send-btn {
            background: white;
            color: black;
        }

        .send-btn:active {
            transform: scale(0.9);
        }

        .typing-indicator {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-left: 1rem;
            margin-bottom: 0.5rem;
            font-style: italic;
            display: none;
        }
    </style>
</head>

<body class="theme-working">
    <div class="background-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
    </div>

    <div class="app-container" style="display:flex; flex-direction:column; padding:0 !important; overflow:hidden;">
        <!-- Header -->
        <div style="padding: 1rem 1.5rem; display:flex; align-items:center; background:rgba(0,0,0,0.1);">
            <div
                style="width:40px; height:40px; background:white; border-radius:50%; display:flex; align-items:center; justify-content:center; margin-right:1rem;">
                <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" style="width:24px; height:24px;">
            </div>
            <div>
                <h1 style="font-size:1.1rem; margin:0; font-weight:600; color:var(--text-color);">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ CareFate AI
                </h1>
                <div style="font-size:0.8rem; color:var(--text-muted); display:flex; align-items:center; gap:5px;">
                    <div style="width:8px; height:8px; background:#22c55e; border-radius:50%;"></div> ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
                </div>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <!-- Welcome Message (JS will insert based on theme) -->
            </div>
            <div class="typing-indicator" id="typingIndicator">CareFate ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå...</div>
        </div>

        <!-- Input Area -->
        <div class="chat-input-area">
            <input type="text" class="chat-input" id="messageInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..."
                onkeypress="handleKeyPress(event)">
            <button class="send-btn" onclick="sendMessage()">
                <i class="fa-solid fa-paper-plane"></i>
            </button>
        </div>

        <!-- Bottom Nav -->
        <div class="bottom-nav">
            <div class="nav-item" onclick="location.href='dashboard.html'"><i class="fa-solid fa-house"></i></div>
            <div class="nav-item" onclick="location.href='history.html'"><i class="fa-solid fa-chart-pie"></i></div>
            <div class="nav-item active"><i class="fa-solid fa-comment-dots"></i></div>
            <div class="nav-item" onclick="location.href='settings.html'"><i class="fa-solid fa-gear"></i></div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://rjszmmogkiblqojikcow.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_RoboGAH-Nqm1dQi3ORqYUQ_StZ7uU4Y';
        let _supabase;
        let currentTheme = 'working'; // default

        // ‚îÄ‚îÄ‚îÄ AI PERSONAS ‚îÄ‚îÄ‚îÄ
        const PERSONAS = {
            'youth': {
                name: '‡∏û‡∏µ‡πà‡πÅ‡∏Ñ‡∏£‡πå‡πÄ‡∏ü‡∏ï',
                tone: 'cheerful, energetic, uses emojis, casual slang',
                welcome: '‡∏´‡∏ß‡∏±‡∏î‡∏î‡∏µ‡∏à‡πâ‡∏≤! üëã ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏û‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡∏°‡∏±‡πâ‡∏¢? ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏°‡πâ‡∏≤‡∏ó‡πå‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡πá‡∏à‡∏±‡∏î‡∏°‡∏≤‡πÄ‡∏•‡∏¢! üíñ‚ú®',
                responses: [
                    '‡πÇ‡∏≠‡πÄ‡∏Ñ‡πÄ‡∏•‡∏¢! ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏û‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏õ‡πä‡∏ö‡∏ô‡∏∂‡∏á‡∏ô‡πâ‡∏≤ üòâ',
                    '‡πÇ‡∏´ ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÑ‡∏õ‡πÄ‡∏•‡∏¢! ‡∏™‡∏π‡πâ‡πÜ ‡∏ô‡∏∞‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á üí™üî•',
                    '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏û‡∏µ‡πà‡∏ß‡πà‡∏≤... ‡∏•‡∏≠‡∏á‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏ö‡πà‡∏≠‡∏¢‡πÜ ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏î‡πâ‡∏ô‡∏∞ üíßüò¥',
                    '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏•‡∏¢‡∏¢‡∏¢ ü•∫ ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏ô‡πâ‡∏≤ ‡πÄ‡∏ò‡∏≠‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏û‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏™‡∏°‡∏≠ üíñ',
                    '‡∏à‡∏±‡∏î‡πÑ‡∏õ! ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏û‡∏µ‡πà‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏ô‡∏∞ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡πà‡∏ß‡∏á! ‚è∞‚ú®'
                ]
            },
            'working': {
                name: '‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ CareFate',
                tone: 'professional, efficient, polite, encouraging',
                welcome: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞ üôè ‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ú‡∏°‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡πÅ‡∏•‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö? ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏°‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö ‚ú®',
                responses: [
                    '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏°‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚úÖ',
                    '‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏≠‡∏µ‡∏Å‡∏™‡∏±‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üßê',
                    '‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏´‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ üíºüçµ',
                    '‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö‡∏ú‡∏° üëç',
                    '‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üè•'
                ]
            },
            'elder': {
                name: '‡∏ô‡πâ‡∏≠‡∏á‡πÅ‡∏Ñ‡∏£‡πå‡πÄ‡∏ü‡∏ï',
                tone: 'respectful, slow-paced, warm, clear simple language',
                welcome: '‡∏Å‡∏£‡∏≤‡∏ö‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≤/‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏≤‡∏¢ üôè ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏™‡∏ö‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏î‡∏µ‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö? ‡πÉ‡∏´‡πâ‡∏´‡∏•‡∏≤‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≠‡πÉ‡∏´‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üëµüë¥üåº',
                responses: [
                    '‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏´‡∏•‡∏≤‡∏ô‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏Ñ‡∏£‡∏±‡∏ö üìù‚ò∫Ô∏è',
                    '‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≤‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡πà‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ä‡∏∏‡πà‡∏°‡∏Ñ‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö üçµüíä',
                    '‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏ô‡πÉ‡∏à‡πÅ‡∏¢‡πà‡πÄ‡∏•‡∏¢ ü•∞üëè',
                    '‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏´‡πà‡∏°‡∏ú‡πâ‡∏≤‡∏´‡∏ô‡∏≤‡πÜ ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢ üß•ü•∂',
                    '‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏´‡∏±‡∏ß ‡∏ô‡∏±‡πà‡∏á‡∏û‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏•‡∏∏‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏£‡πá‡∏ß‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ü™ëüòü'
                ]
            }
        };

        document.addEventListener('DOMContentLoaded', async () => {
            if (window.supabase) {
                _supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            }

            // Sync Theme & Set Persona
            const localTheme = localStorage.getItem('theme');
            if (localTheme) currentTheme = localTheme;

            try {
                if (_supabase) {
                    const { data: { user } } = await _supabase.auth.getUser();
                    if (user && user.user_metadata && user.user_metadata.theme) {
                        currentTheme = user.user_metadata.theme;
                    }
                }
            } catch (e) { }

            applyTheme(currentTheme);

            // Initial Welcome Message
            setTimeout(() => {
                addBotMessage(PERSONAS[currentTheme].welcome);
            }, 600);
        });

        function applyTheme(theme) {
            document.body.classList.remove('theme-youth', 'theme-working', 'theme-elder');
            document.body.classList.add(`theme-${theme}`);
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text) return;

            // 1. Add User Message
            addUserMessage(text);
            input.value = '';

            // 2. Show Typing Indicator
            const typing = document.getElementById('typingIndicator');
            typing.style.display = 'block';

            // 3. Call Real API
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: text,
                        theme: currentTheme
                    })
                });

                const data = await response.json();
                typing.style.display = 'none';

                if (data.status === 'success') {
                    addBotMessage(data.reply);
                } else {
                    addBotMessage('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (' + (data.message || 'Unknown Error') + ')');
                }

            } catch (e) {
                console.error(e);
                typing.style.display = 'none';
                addBotMessage('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ');
            }
        }

        function addUserMessage(text) {
            const div = document.createElement('div');
            div.className = 'message user';
            div.innerText = text;
            document.getElementById('chatMessages').appendChild(div);
            scrollToBottom();
        }

        function addBotMessage(text) {
            const div = document.createElement('div');
            div.className = 'message bot';
            div.innerText = text;
            document.getElementById('chatMessages').appendChild(div);
            scrollToBottom();
        }

        function scrollToBottom() {
            const chatBox = document.getElementById('chatMessages');
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Mock AI Logic - In real app, this would be an API call to OpenAI/Claude with system prompt
        function generateMockResponse(input) {
            const persona = PERSONAS[currentTheme];
            const lowerInput = input.toLowerCase();

            // Simple Keyword Matching
            if (lowerInput.includes('‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ') || lowerInput.includes('hi') || lowerInput.includes('hello')) {
                if (currentTheme === 'youth') return '‡πÑ‡∏Æ‡∏à‡πâ‡∏≤! üëã ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏î‡πÉ‡∏™‡∏à‡∏±‡∏á‡πÄ‡∏•‡∏¢‡∏ô‡∏∞!';
                if (currentTheme === 'elder') return '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏û‡∏µ‡πà ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö? üôè';
                return '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ú‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö?';
            }

            if (lowerInput.includes('‡∏¢‡∏≤') || lowerInput.includes('med')) {
                if (currentTheme === 'youth') return '‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏ï‡∏£‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏∞ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏´‡∏≤‡∏¢‡πÑ‡∏ß‡πÜ! üíäüí®';
                if (currentTheme === 'elder') return '‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡∏Ñ‡∏£‡∏±‡∏ö? ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏´‡∏•‡∏≤‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏¢‡∏≤‡πÉ‡∏´‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üíäüëµ';
                return '‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÑ‡∏ß‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?';
            }

            // Default random response from persona
            const responses = persona.responses;
            return responses[Math.floor(Math.random() * responses.length)];
        }
    </script>
</body>

</html>